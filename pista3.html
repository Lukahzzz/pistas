<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desafío Final - Aranzza</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <style>
        :root {
            --color-primario: #00e6e6; --color-secundario: #4BB543; --color-error: #ff5c5c;
            --color-fondo-oscuro: #0a0a1a; --color-texto-claro: #e0e0e0;
            --color-borde-card: rgba(0, 230, 230, 0.4);
            --fuente-titulo: 'Orbitron', sans-serif; --fuente-cuerpo: 'Share Tech Mono', monospace;
            --glow-color: #00e6e6;
        }

        html {
            box-sizing: border-box;
            font-size: 16px;
        }

        *, *:before, *:after {
            box-sizing: inherit;
        }

        body {
            font-family: var(--fuente-cuerpo);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            background-color: var(--color-fondo-oscuro);
            overflow: hidden;
            color: var(--color-texto-claro);
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%2300e6e6' d='M10 16v-4H6V8h4V4h4v4h4v4h-4v4h-4z'/></svg>") 12 12, auto;
        }

        #particle-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }
        
        .card-container {
            perspective: 1500px;
            width: 90%; /* Efecto "zoom out" */
            max-width: 650px;
        }
        
        .card {
            background: rgba(10, 10, 26, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid var(--color-borde-card);
            border-radius: 20px;
            padding: clamp(1.5rem, 5vw, 3rem); /* Espaciado fluido */
            box-shadow: 0 15px 40px rgba(0,0,0,0.5), 0 0 40px var(--glow-color);
            text-align: center;
            width: 100%;
            animation: fadeIn 1s ease-out 0.5s forwards;
            opacity: 0;
            transform: translateY(20px);
            overflow-wrap: break-word; /* Manejo de texto */
            -webkit-hyphens: auto;
            hyphens: auto;
        }

        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

        #success-screen { display: none; }
        
        h1 {
            font-family: var(--fuente-titulo);
            color: white;
            font-size: clamp(2rem, 7vw, 2.8rem); /* Tipografía fluida */
            margin: 0.4em 0;
            letter-spacing: clamp(1.5px, 0.5vw, 3px);
            text-shadow: 0 0 15px rgba(0,230,230,0.7);
        }

        p {
            font-size: clamp(1rem, 2.5vw, 1.15rem); /* Tipografía fluida */
            line-height: 1.8;
            color: var(--color-texto-claro);
            margin-bottom: 1.5em;
        }

        .icon {
            font-size: clamp(3rem, 10vw, 4rem);
            color: var(--color-primario);
            text-shadow: 0 0 20px var(--color-primario);
            margin-bottom: 0.3em;
        }
        
        #encrypted-text {
            font-family: var(--fuente-cuerpo);
            font-size: clamp(1rem, 3vw, 1.2rem);
            word-break: break-all;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border: 1px dashed var(--color-borde-card);
            border-radius: 8px;
            margin: 1em 0;
            min-height: 100px;
            text-align: left;
            transition: border-color 0.3s;
        }
        
        .encrypted-text-correct {
            border-color: var(--color-secundario);
            box-shadow: 0 0 15px var(--color-secundario);
        }

        .decrypted { color: var(--color-secundario); font-weight: bold; }
        .encrypted { color: var(--color-primario); opacity: 0.7; }
        .hint { font-size: 1em; color: var(--color-texto-claro); opacity: 0.8; margin-top: 2em; font-style: italic; }
        .input-group { margin-top: 1em; }
        
        #key-input {
            padding: 15px;
            width: 100%; /* Ocupa el 100% del espacio disponible */
            max-width: 400px; /* Pero no se hace excesivamente grande */
            border: 2px solid var(--color-primario);
            border-radius: 8px;
            font-size: clamp(1.2rem, 4vw, 1.4rem);
            background-color: rgba(0,0,0,0.6);
            color: white;
            box-shadow: 0 0 8px rgba(0,230,230,0.4);
            font-family: var(--fuente-cuerpo);
            text-align: center;
            transition: all 0.3s;
        }

        #key-input:focus {
            outline: none; border-color: white; box-shadow: 0 0 25px var(--color-primario);
        }

        #final-message {
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            font-weight: bold;
            color: var(--color-secundario);
            text-shadow: 0 0 15px var(--color-secundario);
            line-height: 1.6;
        }

        @keyframes shake {
            from, to { transform: translateX(0); border-color: var(--color-error); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        .shake { animation: shake 0.5s ease-in-out; }
    </style>
</head>
<body>
    <canvas id="particle-canvas"></canvas>
    <audio id="audio-keypress" src="https://assets.mixkit.co/sfx/preview/mixkit-keyboard-key-hit-1486.mp3" preload="auto"></audio>
    <audio id="audio-success" src="https://assets.mixkit.co/sfx/preview/mixkit-game-bonus-reached-2065.mp3" preload="auto"></audio>
    <audio id="audio-error" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" preload="auto"></audio>

    <div class="card-container">
        <div class="card" id="card-pista">
            
            <div id="puzzle-screen">
                <span class="material-symbols-outlined icon">key</span>
                <h1>Desafío Final</h1>
                <p>La transmisión está encriptada. Solo una clave, un recuerdo forjado entre dos agentes, puede revelar el mensaje. La seguridad del protocolo depende de ti.</p>
                <div id="encrypted-text"></div>
                <div class="input-group">
                    <input type="text" id="key-input" placeholder="Comienza a escribir la clave..." autocomplete="off">
                </div>
                <p class="hint">Pista: Estoy en el cuerpo de un...</p>
            </div>

            <div id="success-screen">
                 <span class="material-symbols-outlined icon" style="color:var(--color-secundario); text-shadow: 0 0 10px var(--color-secundario);">lock_open</span>
                <h1>Transmisión Desencriptada</h1>
                <p id="final-message"></p>
            </div>

        </div>
    </div>

    <script>
        // LÓGICA DE PARTÍCULAS (Sin cambios)
        const canvas = document.getElementById('particle-canvas'); const ctx = canvas.getContext('2d'); canvas.width = window.innerWidth; canvas.height = window.innerHeight; let particlesArray = []; class Particle { constructor(x,y,dX,dY,s){this.x=x;this.y=y;this.directionX=dX;this.directionY=dY;this.size=s;} draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2,false);ctx.fillStyle='rgba(0,230,230,0.5)';ctx.fill();} update(){if(this.x>canvas.width||this.x<0){this.directionX=-this.directionX;} if(this.y>canvas.height||this.y<0){this.directionY=-this.directionY;} this.x+=this.directionX;this.y+=this.directionY;this.draw();}} function initParticles(){particlesArray=[];let n=(canvas.height*canvas.width)/9e3;for(let i=0;i<n;i++){let s=Math.random()*2+1,x=Math.random()*(innerWidth-s*2)+s*2,y=Math.random()*(innerHeight-s*2)+s*2,dX=Math.random()*.4-.2,dY=Math.random()*.4-.2;particlesArray.push(new Particle(x,y,dX,dY,s));}} function connectParticles(){let o=1;for(let a=0;a<particlesArray.length;a++){for(let b=a;b<particlesArray.length;b++){let d=(particlesArray[a].x-particlesArray[b].x)**2+(particlesArray[a].y-particlesArray[b].y)**2;if(d<(canvas.width/7)*(canvas.height/7)){o=1-d/2e4;ctx.strokeStyle=`rgba(0,230,230,${o})`;ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(particlesArray[a].x,particlesArray[a].y);ctx.lineTo(particlesArray[b].x,particlesArray[b].y);ctx.stroke();}}}} function animateParticles(){requestAnimationFrame(animateParticles);ctx.clearRect(0,0,innerWidth,innerHeight);for(let i=0;i<particlesArray.length;i++){particlesArray[i].update();}connectParticles();} initParticles();animateParticles();window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;initParticles();});
        
        // --- LÓGICA DEL CIFRADO PROGRESIVO ---
        const mensajeSecreto = "Felicidades, lo lograste. La clave siempre fuiste tú. Tu recompensa final no es un lugar, sino un momento. Date la vuelta, te estoy esperando.";
        const claveSecreta = "perro";
        const encryptedTextEl = document.getElementById('encrypted-text');
        const keyInputEl = document.getElementById('key-input');
        const puzzleScreen = document.getElementById('puzzle-screen');
        const successScreen = document.getElementById('success-screen');
        const finalMessageEl = document.getElementById('final-message');

        function cifrar(texto, clave) {
            let resultado = "";
            for (let i = 0, j = 0; i < texto.length; i++) {
                const char = texto[i];
                if (char.match(/[a-z]/i)) {
                    const esMayuscula = char === char.toUpperCase();
                    const offset = esMayuscula ? 'A'.charCodeAt(0) : 'a'.charCodeAt(0);
                    const claveChar = clave[j % clave.length];
                    const claveOffset = claveChar.charCodeAt(0) - 'a'.charCodeAt(0);
                    const cifradoCharCode = (char.charCodeAt(0) - offset + claveOffset) % 26;
                    resultado += String.fromCharCode(cifradoCharCode + offset);
                    j++;
                } else {
                    resultado += char;
                }
            }
            return resultado;
        }

        const textoCifrado = cifrar(mensajeSecreto, claveSecreta);
        const piezasDelMensaje = mensajeSecreto.split(/(\s+)/);

        encryptedTextEl.innerHTML = `<span class="encrypted">${textoCifrado}</span>`;
        
        keyInputEl.addEventListener('input', updateDecryption);

        function updateDecryption() {
            const userInput = keyInputEl.value.toLowerCase();
            const partialKey = claveSecreta.substring(0, userInput.length);

            if (userInput === partialKey) {
                document.getElementById('audio-keypress').cloneNode(true).play();
                
                const progress = userInput.length / claveSecreta.length;
                const piezasAMostrar = Math.ceil(progress * piezasDelMensaje.length);
                const decryptedPart = piezasDelMensaje.slice(0, piezasAMostrar).join("");
                const stillEncryptedPart = textoCifrado.substring(decryptedPart.length);

                encryptedTextEl.innerHTML = `<span class="decrypted">${decryptedPart}</span><span class="encrypted">${stillEncryptedPart}</span>`;

                if (userInput === claveSecreta) {
                    triggerSuccess();
                }

            } else {
                document.getElementById('audio-error').cloneNode(true).play();
                keyInputEl.classList.add('shake');
                keyInputEl.value = userInput.slice(0, -1);
                
                setTimeout(() => {
                    keyInputEl.classList.remove('shake');
                }, 500);
            }
        }

        function triggerSuccess() {
            keyInputEl.disabled = true;
            encryptedTextEl.classList.add('encrypted-text-correct');
            document.getElementById('audio-success').play();
            
            setTimeout(() => {
                puzzleScreen.style.display = 'none';
                successScreen.style.display = 'block';
                finalMessageEl.textContent = mensajeSecreto;
            }, 1500);
        }
    </script>
</body>
</html>
