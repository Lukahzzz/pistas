<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desafío Final - Aranzza</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <style>
        :root {
            --color-primario: #00BFFF; /* Azul cielo/cian (Limpieza) */
            --color-secundario: #4BB543; /* Verde éxito */
            --color-error: #ff5c5c; /* Rojo error */
            --color-fondo-oscuro: #0a0a1a;
            --color-texto-claro: #e0e0e0;
            --color-borde-card: rgba(0, 191, 255, 0.4); 
            --fuente-titulo: 'Orbitron', sans-serif;
            --fuente-cuerpo: 'Share Tech Mono', monospace;
            --glow-color: #00FA9A; /* Verde esmeralda (Brillo) */
        }
        body { 
            font-family: var(--fuente-cuerpo); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 20px; 
            background-color: var(--color-fondo-oscuro); 
            box-sizing: border-box; 
            color: var(--color-texto-claro); 
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%2300FA9A' d='M18 13h-5v5h-2v-5H6v-2h5V6h2v5h5v2z'/></svg>") 12 12, auto; 
        }
        #particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .card-container { perspective: 1500px; padding: 20px 0; }
        .card { 
            background: rgba(10, 10, 26, 0.7); backdrop-filter: blur(20px); border: 1px solid var(--color-borde-card); border-radius: 20px; 
            padding: 3em; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.5), 0 0 40px var(--glow-color); 
            text-align: center; max-width: 650px; width: 100%; animation: fadeIn 1s ease-out 0.5s forwards; opacity: 0; transform: translateY(20px); 
        }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #success-screen, #quiz-screen, #love-message-screen { display: none; }
        h1 { font-family: var(--fuente-titulo); color: white; font-size: 2.8em; margin: 0.4em 0; letter-spacing: 3px; text-shadow: 0 0 15px rgba(0,191,255,0.7); }
        p { font-size: 1.15em; line-height: 1.8; color: var(--color-texto-claro); margin-bottom: 1.5em; }
        .icon { font-size: 4em; color: var(--glow-color); text-shadow: 0 0 20px var(--glow-color); margin-bottom: 0.3em; }
        #encrypted-text { font-family: var(--fuente-cuerpo); font-size: 1.2em; word-break: break-all; padding: 20px; background: rgba(0,0,0,0.3); border: 1px dashed var(--color-borde-card); border-radius: 8px; margin: 1em 0; min-height: 100px; text-align: left; transition: border-color 0.3s; }
        .encrypted-text-correct { border-color: var(--color-secundario); box-shadow: 0 0 15px var(--color-secundario); }
        .decrypted { color: var(--color-secundario); font-weight: bold; }
        .encrypted { color: var(--color-primario); opacity: 0.7; }
        .hint { font-size: 1em; color: var(--color-texto-claro); opacity: 0.8; margin-top: 2em; font-style: italic; }
        .input-group { margin-top: 1em; }
        #key-input { padding: 15px; width: 80%; border: 2px solid var(--color-primario); border-radius: 8px; font-size: 1.4em; background-color: rgba(0,0,0,0.6); color: white; box-shadow: 0 0 8px rgba(0,191,255,0.4); font-family: var(--fuente-cuerpo); text-align: center; transition: all 0.3s; }
        #key-input:focus { outline: none; border-color: white; box-shadow: 0 0 25px var(--glow-color); }
        #final-message { font-size: 1.5em; font-weight: bold; color: var(--color-secundario); text-shadow: 0 0 15px var(--color-secundario); line-height: 1.6; margin-bottom: 1.5em;}
        @keyframes shake { from, to { transform: translateX(0); border-color: var(--color-error); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); } 20%, 40%, 60%, 80% { transform: translateX(10px); } }
        .shake { animation: shake 0.5s ease-in-out; }

        /* AJUSTE DEL BOTÓN DE CUESTIONARIO */
        #success-screen .button-container {
            margin-top: 30px;
            display: flex;
            justify-content: center;
        }

        .quiz-button { 
            background-color: var(--color-primario); color: var(--color-fondo-oscuro);
            border: 2px solid var(--color-primario); border-radius: 5px; 
            padding: 12px 25px; 
            font-size: 1.1em; 
            cursor: pointer; transition: all 0.3s;
            font-family: var(--fuente-cuerpo); 
            box-shadow: 0 0 15px rgba(0,191,255,0.6); 
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .quiz-button:hover { 
            background-color: var(--color-fondo-oscuro); 
            color: var(--color-primario);
            box-shadow: 0 0 25px var(--glow-color); 
            transform: scale(1.03); 
        }
        .quiz-button .material-symbols-outlined { font-size: 1.4em; }

        /* Estilos del Cuestionario */
        .quiz-question { text-align: left; margin-top: 25px; border-top: 1px dashed var(--color-borde-card); padding-top: 15px; }
        .quiz-question label { display: block; margin: 10px 0; font-size: 1em; cursor: pointer; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; transition: background 0.2s; }
        .quiz-question label:hover { background: rgba(0, 191, 255, 0.1); }
        .quiz-question input[type="radio"] { margin-right: 10px; accent-color: var(--color-primario); }
        
        #quiz-results { margin-top: 20px; font-size: 1.3em; font-weight: bold; }
        
        #love-message-screen { background: rgba(10, 10, 26, 0.95); border: 3px solid #ff69b4; box-shadow: 0 0 50px #ff69b4; padding: 3em; }
        #love-message-screen h1 { color: #ff69b4; text-shadow: 0 0 20px #ff69b4; font-size: 3em; }
        
        /* ESTILO CLAVE: Usado para el resaltado del mensaje de amor */
        .message-highlight {
            color: var(--glow-color); /* Usando el color verde esmeralda */
            text-shadow: 0 0 10px rgba(0, 250, 154, 0.5);
            font-weight: bold;
        }

        #love-message-screen p { font-size: 1.5em; color: white; line-height: 1.8; }

        @media (max-width: 600px) {
            .card { padding: 1.5em; }
            h1 { font-size: 2.2em; }
            #key-input { width: 95%; font-size: 1.2em; }
            #love-message-screen h1 { font-size: 2.5em; }
            #love-message-screen p { font-size: 1.2em; }
        }

    </style>
</head>
<body>
    <canvas id="particle-canvas"></canvas>
    <audio id="audio-keypress" src="https://assets.mixkit.co/sfx/preview/mixkit-keyboard-key-hit-1486.mp3" preload="auto"></audio>
    <audio id="audio-success" src="https://assets.mixkit.co/sfx/preview/mixkit-game-bonus-reached-2065.mp3" preload="auto"></audio>
    <audio id="audio-error" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" preload="auto"></audio>
    <audio id="audio-reveal" src="https://assets.mixkit.co/sfx/preview/mixkit-romantic-reveal-3151.mp3" preload="auto"></audio>

    <div class="card-container">
        <div class="card" id="card-pista">
            
            <div id="puzzle-screen">
                <span class="material-symbols-outlined icon">health_and_safety</span>
                <h1>Desafío Final: Raíz Craneal</h1>
                <p>El diagnóstico crítico está encriptado. Solo la clave del <span style="color: var(--glow-color);">VII Par Craneal</span>, un <span style="color: var(--glow-color);">recuerdo fundamental de nuestro estudio</span>, puede revelar el mensaje. La Doctora debe usar su memoria con precisión.</p>
                <div id="encrypted-text"></div>
                <div class="input-group">
                    <input type="text" id="key-input" placeholder="Comienza a escribir la clave..." autocomplete="off">
                </div>
                <p class="hint">Pista: El nervio responsable de tu más hermosa sonrisa...</p>
            </div>

            <div id="success-screen">
                 <span class="material-symbols-outlined icon" style="color:var(--color-secundario); text-shadow: 0 0 10px var(--color-secundario);">lock_open</span>
                <h1>Diagnóstico Desencriptado</h1>
                <p id="final-message"></p>
                <div class="button-container">
                    <button class="quiz-button" onclick="startQuiz()">
                        <span class="material-symbols-outlined">favorite</span>
                        ACCEDER AL EXPEDIENTE PRIVADO
                    </button>
                </div>
            </div>

            <div id="quiz-screen">
                <span class="material-symbols-outlined icon" style="color: #ff69b4;">quiz</span>
                <h1>Cuestionario de Conexión</h1>
                <p>Responde estas 5 preguntas rápidas. Tu <span style="color: var(--glow-color);">dominio de la Odontología</span> y nuestra historia es el último requisito.</p>
                
                <form id="quiz-form">
                    <div class="quiz-question" data-answer="Esmalte">
                        <p>1. ¿Cuál es el tejido más duro del cuerpo humano?</p>
                        <label><input type="radio" name="q1" value="Dentina"> Dentina</label>
                        <label><input type="radio" name="q1" value="Cemento"> Cemento</label>
                        <label><input type="radio" name="q1" value="Esmalte"> Esmalte</label>
                    </div>
                    
                    <div class="quiz-question" data-answer="Clase I">
                        <p>2. ¿Cómo se llama la clasificación de la caries que afecta solo las caras oclusales?</p>
                        <label><input type="radio" name="q2" value="Clase IV"> Clase IV</label>
                        <label><input type="radio" name="q2" value="Clase I"> Clase I</label>
                        <label><input type="radio" name="q2" value="Clase V"> Clase V</label>
                    </div>
                    
                    <div class="quiz-question" data-answer="Maxilar">
                        <p>3. ¿A qué hueso pertenece la eminencia o tuberosidad?</p>
                        <label><input type="radio" name="q3" value="Mandíbula"> Mandíbula</label>
                        <label><input type="radio" name="q3" value="Cigomático"> Cigomático</label>
                        <label><input type="radio" name="q3" value="Maxilar"> Maxilar</label>
                    </div>

                    <div class="quiz-question" data-answer="Amalgama">
                        <p>4. ¿Cuál de estos materiales es la opción más económica para una restauración?</p>
                        <label><input type="radio" name="q4" value="Cerámica"> Cerámica</label>
                        <label><input type="radio" name="q4" value="Amalgama"> Amalgama</label>
                        <label><input type="radio" name="q4" value="Resina"> Resina</label>
                    </div>

                    <div class="quiz-question" data-answer="Primer molar inferior">
                        <p>5. ¿Cuál es la primera pieza dental permanente en erupcionar?</p>
                        <label><input type="radio" name="q5" value="Incisivo central superior"> Incisivo central superior</label>
                        <label><input type="radio" name="q5" value="Canino inferior"> Canino inferior</label>
                        <label><input type="radio" name="q5" value="Primer molar inferior"> Primer molar inferior</label>
                    </div>
                    
                    <div class="button-container">
                        <button type="button" class="quiz-button" onclick="submitQuiz()">
                            <span class="material-symbols-outlined">check_circle</span>
                            VERIFICAR RESULTADOS
                        </button>
                    </div>
                    <p id="quiz-results" style="color: var(--color-error);"></p>
                </form>
            </div>
            
            <div id="love-message-screen">
                <span class="material-symbols-outlined icon" style="color:#ff69b4; text-shadow: 0 0 20px #ff69b4;">favorite</span>
                <h1>¡Misión Cumplida!</h1>
                <p id="love-message-content"></p> 
                
                <p style="font-size:1.8em; color: #00BFFF; text-shadow: 0 0 10px #00BFFF; font-weight: bold; margin-top: 2em;">Te Amo, Aranzza.</p>
            </div>

        </div>
    </div>

    <script>
        // LÓGICA DE PARTÍCULAS (Mantenida y corregida)
        const canvas = document.getElementById('particle-canvas'); const ctx = canvas.getContext('2d'); canvas.width = window.innerWidth; canvas.height = window.innerHeight; let particlesArray = []; 
        class Particle { constructor(x,y,dX,dY,s){this.x=x;this.y=y;this.directionX=dX;this.directionY=dY;this.size=s;} 
            draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2,false);ctx.fillStyle='rgba(0,250,154,0.5)';ctx.fill();} 
            update(){if(this.x>canvas.width||this.x<0){this.directionX=-this.directionX;} if(this.y>canvas.height||this.y<0){this.directionY=-this.directionY;} this.x+=this.directionX;this.y+=this.directionY;this.draw();}} 
        function initParticles(){particlesArray=[];let n=(canvas.height*canvas.width)/9e3;for(let i=0;i<n;i++){let s=Math.random()*2+1,x=Math.random()*(innerWidth-s*2)+s*2,y=Math.random()*(innerHeight-s*2)+s*2,dX=Math.random()*.4-.2,dY=Math.random()*.4-.2;particlesArray.push(new Particle(x,y,dX,dY,s));}} 
        function connectParticles(){let o=1;for(let a=0;a<particlesArray.length;a++){for(let b=a;b<particlesArray.length;b++){
            let d=(particlesArray[a].x-particlesArray[b].x)**2+(particlesArray[a].y-particlesArray[b].y)**2;if(d<(canvas.width/7)*(canvas.height/7)){o=1-d/2e4;ctx.strokeStyle=`rgba(0,250,154,${o})`;ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(particlesArray[a].x,particlesArray[a].y);ctx.lineTo(particlesArray[b].x,particlesArray[b].y);ctx.stroke();}}}} 
        function animateParticles(){requestAnimationFrame(animateParticles);ctx.clearRect(0,0,innerWidth,innerHeight);for(let i=0;i<particlesArray.length;i++){particlesArray[i].update();}connectParticles();} initParticles();animateParticles();window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;initParticles();});
        
        // --- LÓGICA DEL CIFRADO PROGRESIVO ---
        const mensajeSecreto = "La precisión del Facial ha sido la clave. Nuestro camino ha sido tan complejo como las raíces de un molar. Felicidades, Doctora Aranzza. Date la vuelta, te estoy esperando.";
        
        // Mensaje de amor con la redacción exacta y los marcadores de asteriscos dobles
        const mensajeAmor = "Tu precisión diagnóstica y tu corazón son impecables. Has superado cada obstáculo con inteligencia y dedicación. No solo para mi eres la mejor odontóloga, eres mi persona favorita.\n\nEste desafío termina aquí, pero nuestro camino juntos apenas comienza. Mi recompensa para ti es una vida llena de amor, sonrisas perfectas y mucha, mucha comida.";
        
        const claveSecreta = "facial";
        
        const puzzleScreen = document.getElementById('puzzle-screen');
        const successScreen = document.getElementById('success-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const loveMessageScreen = document.getElementById('love-message-screen');
        const encryptedTextEl = document.getElementById('encrypted-text');
        const keyInputEl = document.getElementById('key-input');
        const finalMessageEl = document.getElementById('final-message');
        const loveMessageContentEl = document.getElementById('love-message-content');

        function cifrar(texto, clave) {
            let resultado = "";
            for (let i = 0, j = 0; i < texto.length; i++) {
                const char = texto[i];
                if (char.match(/[a-z]/i)) {
                    const esMayuscula = char === char.toUpperCase();
                    const offset = esMayuscula ? 'A'.charCodeAt(0) : 'a'.charCodeAt(0);
                    const claveChar = clave[j % clave.length];
                    const claveOffset = claveChar.charCodeAt(0) - 'a'.charCodeAt(0);
                    const cifradoCharCode = (char.charCodeAt(0) - offset + claveOffset) % 26;
                    resultado += String.fromCharCode(cifradoCharCode + offset);
                    j++;
                } else {
                    resultado += char;
                }
            }
            return resultado;
        }
        
        // Función para parsear el mensaje y aplicar el resaltado y saltos de línea
        function parseMessage(text) {
            // Reemplaza **frase** con <span class="message-highlight">frase</span>
            let html = text.replace(/\*\*(.*?)\*\*/g, '<span class="message-highlight">$1</span>');
            // Reemplaza \n con <br><br> para los saltos de línea
            html = html.replace(/\n/g, '<br><br>');
            return html;
        }


        const textoCifrado = cifrar(mensajeSecreto, claveSecreta);
        
        const piezasDelMensaje = mensajeSecreto.split(/(\s+)/);

        encryptedTextEl.innerHTML = `<span class="encrypted">${textoCifrado}</span>`;
        
        keyInputEl.addEventListener('input', updateDecryption);

        function updateDecryption() {
            const userInput = keyInputEl.value.toLowerCase();
            const partialKey = claveSecreta.substring(0, userInput.length);

            if (userInput === partialKey) {
                document.getElementById('audio-keypress').cloneNode(true).play();
                
                const progress = userInput.length / claveSecreta.length;
                const piezasAMostrar = Math.ceil(progress * piezasDelMensaje.length);
                
                let decryptedPart = "";
                for(let i = 0; i < piezasAMostrar; i++) {
                    decryptedPart += piezasDelMensaje[i];
                }

                const stillEncryptedPart = textoCifrado.substring(decryptedPart.length);

                encryptedTextEl.innerHTML = `<span class="decrypted">${decryptedPart}</span><span class="encrypted">${stillEncryptedPart}</span>`;

                if (userInput === claveSecreta) {
                    triggerSuccess();
                }

            } else {
                document.getElementById('audio-error').cloneNode(true).play();
                keyInputEl.classList.add('shake');
                keyInputEl.value = userInput.slice(0, -1);
                
                setTimeout(() => {
                    keyInputEl.classList.remove('shake');
                }, 500);
            }
        }

        function triggerSuccess() {
            keyInputEl.disabled = true;
            encryptedTextEl.classList.add('encrypted-text-correct');
            document.getElementById('audio-success').play();
            
            setTimeout(() => {
                puzzleScreen.style.display = 'none';
                successScreen.style.display = 'block';
                finalMessageEl.textContent = mensajeSecreto;
            }, 1500);
        }

        // --- LÓGICA DEL CUESTIONARIO FINAL ---
        function startQuiz() {
            successScreen.style.display = 'none';
            quizScreen.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function submitQuiz() {
            const quizForm = document.getElementById('quiz-form');
            const questions = quizForm.querySelectorAll('.quiz-question');
            const resultsEl = document.getElementById('quiz-results');
            let correctCount = 0;

            questions.forEach(q => {
                const correctAnswer = q.getAttribute('data-answer');
                const selected = q.querySelector('input:checked');
                
                if (selected && selected.value === correctAnswer) {
                    correctCount++;
                }
            });

            if (correctCount >= 3) {
                document.getElementById('audio-reveal').play();
                quizScreen.style.display = 'none';
                // APLICAR EL PARSEO Y RESALTADO AQUÍ
                loveMessageContentEl.innerHTML = parseMessage(mensajeAmor); 
                loveMessageScreen.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                document.getElementById('audio-error').play();
                resultsEl.textContent = `Resultado: ${correctCount}/5. Necesitas 3 o más. ¡Intenta de nuevo y demuestra tu conocimiento!`;
            }
        }
    </script>
</body>
</html>

